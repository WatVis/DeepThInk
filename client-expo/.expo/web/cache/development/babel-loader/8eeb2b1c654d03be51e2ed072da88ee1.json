{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"C:\\\\Users\\\\aapri\\\\Repo\\\\draw-therapy\\\\client-expo\\\\components\\\\DrawCanvas.js\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component, useRef } from 'react';\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport Canvas, { Image as CanvasImage } from 'react-native-canvas';\nimport { generateStyle } from \"../styles/styles\";\nimport Point from \"../classes/Point\";\nimport { sendStroke, sendStrokeEnd, sendStrokeStart } from \"../api/websocketApi.js\";\nvar device = Dimensions.get('window');\nvar styles = StyleSheet.create(generateStyle(device));\n\nvar DrawCanvas = function (_Component) {\n  _inherits(DrawCanvas, _Component);\n\n  var _super = _createSuper(DrawCanvas);\n\n  function DrawCanvas(props) {\n    var _this;\n\n    _classCallCheck(this, DrawCanvas);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      strokes: []\n    };\n\n    _this.onDrawMove = function (event) {\n      var posX = event.nativeEvent.locationX;\n      var posY = event.nativeEvent.locationY;\n      var p = new Point(posX, posY, _this.props.thickness, _this.props.color, \"move\");\n\n      _this.updateCanvas(p, \"self\");\n\n      _this.setState({\n        strokes: _this.state.strokes.concat(p)\n      });\n\n      sendStroke(_this.props.socket, {\n        x: posX,\n        y: posY\n      }, _this.props.color, _this.props.thickness);\n    };\n\n    _this.onDrawStart = function (event) {\n      var posX = event.nativeEvent.locationX;\n      var posY = event.nativeEvent.locationY;\n      var p = new Point(posX, posY, _this.props.thickness, _this.props.color, \"start\");\n\n      _this.updateCanvas(p, \"self\");\n\n      _this.setState({\n        strokes: _this.state.strokes.concat(p)\n      });\n\n      sendStrokeStart(_this.props.socket, {\n        x: p.x,\n        y: p.y\n      }, p.thickness, p.color);\n    };\n\n    _this.onDrawEnd = function (event) {\n      var posX = event.nativeEvent.locationX;\n      var posY = event.nativeEvent.locationY;\n      var p = new Point(posX, posY, _this.props.thickness, _this.props.color, \"end\");\n\n      _this.updateCanvas(p, \"self\");\n\n      _this.setState({\n        strokes: _this.state.strokes.concat(p)\n      });\n\n      sendStrokeEnd(_this.props.socket, _this.props.color, _this.props.thickness);\n    };\n\n    _this.updateCanvas = function (point, client) {\n      console.log(\"canvas ref in update is\", client);\n\n      if (!_this.canvasRef) {\n        return;\n      }\n\n      var strokes;\n      var lastPoint;\n\n      if (client == \"self\") {\n        if (!_this.state.strokes || _this.state.strokes.length < 1) {\n          return;\n        } else {\n          strokes = _this.state.strokes;\n          lastPoint = strokes[strokes.length - 1];\n        }\n      } else {\n        if (!_this.props.otherStrokes || _this.props.otherStrokes.length < 3) {\n          return;\n        } else {\n          strokes = _this.props.otherStrokes;\n          lastPoint = strokes[strokes.length - 2];\n        }\n      }\n\n      var canvas = _this.canvasRef.current;\n      var len = strokes.length;\n\n      if (canvas && len > 0) {\n        var x = point.x,\n            y = point.y,\n            type = point.type,\n            thickness = point.thickness;\n        var ctx = canvas.getContext(\"2d\");\n        ctx.lineWidth = thickness;\n\n        switch (type) {\n          case \"start\":\n            ctx.moveTo(x, y);\n            ctx.beginPath();\n            ctx.lineTo(x, y);\n            break;\n\n          case \"end\":\n            break;\n\n          case \"move\":\n            ctx.beginPath();\n            ctx.moveTo(lastPoint.x, lastPoint.y);\n            ctx.globalCompositeOperation = 'source-over';\n            ctx.lineTo(x, y);\n            break;\n        }\n\n        ctx.fillStyle = point.color;\n        ctx.strokeStyle = point.color;\n        ctx.lineJoin = ctx.lineCap = 'round';\n        ctx.closePath();\n        ctx.stroke();\n      }\n    };\n\n    _this.handleCanvas = function (canvas) {\n      var ctx = canvas.getContext('2d');\n      canvas.width = device.width * 0.45;\n      canvas.height = device.height * 0.85;\n      _this.canvasRef = canvas;\n      _this.canvasRef.current = canvas;\n    };\n\n    _this.getPathData = function (x, y, width, color) {\n      return {\n        drawer: null,\n        size: {\n          width: _this.canvas._size.width,\n          height: _this.canvas._size.height\n        },\n        path: {\n          data: [x.toString() + \",\" + y.toString()],\n          width: width,\n          color: color,\n          id: parseInt(Math.random() * 100000000)\n        }\n      };\n    };\n\n    _this.getPathDataArray = function (data, width, color) {\n      parsedArr = [];\n\n      for (var i = 0; i < data.length; i++) {\n        parsedArr.push(data[i].x + \",\" + data[i].y);\n      }\n\n      return {\n        drawer: null,\n        size: {\n          width: _this.canvas._size.width,\n          height: _this.canvas._size.height\n        },\n        path: {\n          data: parsedArr,\n          width: width,\n          color: color,\n          id: parseInt(Math.random() * 100000000)\n        }\n      };\n    };\n\n    _this.getBase64 = function _callee() {\n      var canvas, ret;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              canvas = _this.canvasRef.current;\n              console.log(\"Getting base64 is\", canvas.toDataURL());\n              ret = canvas.toDataURL();\n\n              if (!(typeof ret == \"string\")) {\n                _context.next = 7;\n                break;\n              }\n\n              return _context.abrupt(\"return\", Promise.resolve(ret));\n\n            case 7:\n              return _context.abrupt(\"return\", ret);\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.onStrokeChangeHandler = function (x, y) {\n      sendStroke(_this.props.socket, {\n        x: x,\n        y: y\n      }, _this.props.color, _this.props.thickness);\n    };\n\n    _this.onStrokeEndHandler = function () {\n      sendStrokeEnd(_this.props.socket, _this.props.color, _this.props.thickness);\n    };\n\n    _this.onStrokeStartHandler = function (x, y) {\n      sendStrokeStart(_this.props.socket);\n    };\n\n    _this.handleCanvas = _this.handleCanvas.bind(_assertThisInitialized(_this));\n    _this.thickness = props.thickness;\n    _this.color = props.color;\n    _this.canvasRef = null;\n    return _this;\n  }\n\n  _createClass(DrawCanvas, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (prevProps.otherStrokes != this.props.otherStrokes) {\n        if (this.props.otherStrokes.length > 0) {\n          var newStroke = this.props.otherStrokes[this.props.otherStrokes.length - 1];\n          this.updateCanvas(newStroke, \"other\");\n        }\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (Platform.OS === \"web\") {\n        return React.createElement(View, {\n          style: styles.drawBoxInner,\n          onStartShouldSetResponder: function onStartShouldSetResponder(event) {\n            return true;\n          },\n          onMoveShouldSetResponder: function onMoveShouldSetResponder(event) {\n            return true;\n          },\n          onResponderStart: this.onDrawStart,\n          onResponderMove: this.onDrawMove,\n          onResponderRelease: this.onDrawEnd,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 252,\n            columnNumber: 3\n          }\n        }, React.createElement(\"canvas\", {\n          style: {\n            \"borderColor\": \"black\"\n          },\n          ref: this.handleCanvas,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 260,\n            columnNumber: 9\n          }\n        }));\n      } else {\n        return React.createElement(View, {\n          onStartShouldSetResponder: function onStartShouldSetResponder(event) {\n            return true;\n          },\n          onMoveShouldSetResponder: function onMoveShouldSetResponder(event) {\n            return true;\n          },\n          onResponderStart: this.onDrawStart,\n          onResponderMove: this.onDrawMove,\n          onResponderRelease: this.onDrawEnd,\n          style: styles.drawBox,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 4\n          }\n        }, React.createElement(Canvas, {\n          width: styles.drawBox.width,\n          height: styles.drawBox.height,\n          ref: this.handleCanvas,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 4\n          }\n        }));\n      }\n    }\n  }]);\n\n  return DrawCanvas;\n}(Component);\n\nexport { DrawCanvas as default };","map":{"version":3,"sources":["C:/Users/aapri/Repo/draw-therapy/client-expo/components/DrawCanvas.js"],"names":["React","Component","useRef","Canvas","Image","CanvasImage","generateStyle","Point","sendStroke","sendStrokeEnd","sendStrokeStart","device","Dimensions","get","styles","StyleSheet","create","DrawCanvas","props","state","strokes","onDrawMove","event","posX","nativeEvent","locationX","posY","locationY","p","thickness","color","updateCanvas","setState","concat","socket","x","y","onDrawStart","onDrawEnd","point","client","console","log","canvasRef","lastPoint","length","otherStrokes","canvas","current","len","type","ctx","getContext","lineWidth","moveTo","beginPath","lineTo","globalCompositeOperation","fillStyle","strokeStyle","lineJoin","lineCap","closePath","stroke","handleCanvas","width","height","getPathData","drawer","size","_size","path","data","toString","id","parseInt","Math","random","getPathDataArray","parsedArr","i","push","getBase64","toDataURL","ret","Promise","resolve","onStrokeChangeHandler","onStrokeEndHandler","onStrokeStartHandler","bind","prevProps","newStroke","Platform","OS","drawBoxInner","drawBox"],"mappings":"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","sourcesContent":["import React, { Component, useRef } from 'react';\r\nimport {Text, View, Platform, StyleSheet, Dimensions} from 'react-native';\r\nimport Canvas, {Image as CanvasImage} from 'react-native-canvas';\r\nimport { generateStyle } from '../styles/styles';\r\nimport Point from \"../classes/Point\";\r\nimport {\r\n\tsendStroke,\r\n\tsendStrokeEnd,\r\n\tsendStrokeStart,\r\n  } from '../api/websocketApi.js';\r\n  \r\nvar device = Dimensions.get('window');\r\n\r\n\r\nconst styles = StyleSheet.create(generateStyle(device));\r\n\r\n\r\n\r\nexport default class DrawCanvas extends Component {\r\n\r\n\r\n\tstate = {\r\n\t\tstrokes: []\r\n\t}\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.handleCanvas = this.handleCanvas.bind(this);\r\n\t\tthis.thickness = props.thickness\r\n\t\tthis.color = props.color\r\n\t\tthis.canvasRef = null;\r\n\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps) {\r\n\t\tif (prevProps.otherStrokes != this.props.otherStrokes) {\r\n\t\t//   console.log(\"collaborator\", prevProps.otherStrokes, \"new:\", this.props.otherStrokes)\r\n\t\t\tif (this.props.otherStrokes.length > 0) {\r\n\t\t\t\tvar newStroke = this.props.otherStrokes[this.props.otherStrokes.length-1]\r\n\t\t\t\tthis.updateCanvas(newStroke, \"other\")\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t}\t  \r\n\t\r\n    onDrawMove = (event) => {\r\n\t\t// console.log(event.nativeEvent)\r\n        // console.log(\"hello\");\r\n\t\tvar posX = event.nativeEvent.locationX\r\n\t\tvar posY = event.nativeEvent.locationY\r\n\r\n\t\tvar p = new Point(posX, posY, this.props.thickness, this.props.color, \"move\")\r\n\t\tthis.updateCanvas(p, \"self\")\r\n\r\n\t\t// Create stroke move object\r\n\t\tthis.setState({\r\n\t\t\tstrokes: this.state.strokes.concat(p)\r\n\t\t})\r\n\t\tsendStroke(this.props.socket, {x: posX, y: posY}, this.props.color, this.props.thickness)\r\n\t\t\r\n    }\r\n\r\n\tonDrawStart = (event) => {\r\n\t\t// console.log(\"Got start event:\", event)\r\n\t\tvar posX = event.nativeEvent.locationX\r\n\t\tvar posY = event.nativeEvent.locationY\r\n\r\n\t\t// Create stroke move object\r\n\t\tvar p = new Point(posX, posY, this.props.thickness, this.props.color, \"start\")\r\n\t\tthis.updateCanvas(p, \"self\")\r\n\r\n\t\tthis.setState({\r\n\t\t\tstrokes: this.state.strokes.concat(p)\r\n\t\t} )\r\n\t\t// socket: start stroke\r\n\t\tsendStrokeStart(this.props.socket, {x: p.x, y: p.y}, p.thickness, p.color);\r\n\r\n\t}\r\n\r\n\tonDrawEnd = (event) => {\r\n\t\tvar posX = event.nativeEvent.locationX\r\n\t\tvar posY = event.nativeEvent.locationY\r\n\r\n\t\t// Create stroke move object\r\n\t\tvar p = new Point(posX, posY, this.props.thickness, this.props.color,  \"end\")\r\n\t\tthis.updateCanvas(p, \"self\")\r\n\r\n\t\tthis.setState({\r\n\t\t\tstrokes: this.state.strokes.concat(p)\r\n\t\t})\r\n\t\t// socket: end stroke\r\n\t\tsendStrokeEnd(this.props.socket, this.props.color, this.props.thickness);\r\n\t}\r\n\r\n\tupdateCanvas = (point, client) => {\r\n\t\t// client: \"self\" | \"other\"\r\n\t\t// point: Point\r\n\r\n\t\t// draw a point\r\n\t\tconsole.log(\"canvas ref in update is\", client)\r\n\t\tif (!this.canvasRef) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar strokes;\r\n\t\tvar lastPoint;\r\n\t\t// Error checking\r\n\t\tif (client == \"self\")\r\n\t\t{\r\n\t\t\tif (!this.state.strokes || this.state.strokes.length < 1)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tstrokes = this.state.strokes\r\n\t\t\t\tlastPoint = strokes[strokes.length-1]\t\r\n\t\t\t}\r\n\t\t} else\r\n\t\t{\r\n\t\t\tif (!this.props.otherStrokes || this.props.otherStrokes.length < 3)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t} else {\r\n\t\t\t\tstrokes = this.props.otherStrokes\r\n\t\t\t\tlastPoint = strokes[strokes.length-2]\t\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\r\n\r\n\r\n\t\tvar canvas = this.canvasRef.current\r\n\t\tvar len = strokes.length\r\n\t\t// console.log(\"canvas is\", canvas == null)\r\n\r\n\t\tif (canvas && len > 0) {\r\n\t\t\tvar {x, y, type, thickness} = point\r\n\t\t\t// console.log(\"lastpoint is\", lastPoint, \"point is\",)\r\n\t\t\tvar ctx = canvas.getContext(\"2d\");\r\n\t\t\tctx.lineWidth = thickness\r\n\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase \"start\":\r\n\t\t\t\t\tctx.moveTo(x, y)\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.lineTo(x, y);\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"end\":\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"move\":\r\n\t\t\t\t\tctx.beginPath();\r\n\r\n\t\t\t\t\tctx.moveTo(lastPoint.x, lastPoint.y)\r\n\r\n\t\t\t\t\tctx.globalCompositeOperation = 'source-over';\r\n\t\t\t\t\tctx.lineTo(x, y);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\t\t\tctx.fillStyle = point.color;\r\n\t\t\tctx.strokeStyle = point.color;\r\n\t\t\tctx.lineJoin = ctx.lineCap = 'round';\r\n\t\t\tctx.closePath()\r\n\t\t\tctx.stroke();\t\t\t\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\thandleCanvas = (canvas) => {\r\n\t\t// console.log(\"handling canvas\", canvas)\r\n\r\n\t\tconst ctx = canvas.getContext('2d');\r\n\t\tcanvas.width = device.width * 0.45;\r\n\t\tcanvas.height = device.height * 0.85;\r\n\r\n\t\tthis.canvasRef = canvas;\r\n\t\tthis.canvasRef.current = canvas;\r\n\r\n\t}\r\n\r\n\r\n\tgetPathData = (x, y, width, color) => {\r\n\t\treturn {\r\n\t\t  drawer: null,\r\n\t\t  size: {\r\n\t\t\twidth: this.canvas._size.width,\r\n\t\t\theight: this.canvas._size.height,\r\n\t\t  },\r\n\t\t  path: {\r\n\t\t\tdata: [`${x.toString()},${y.toString()}`],\r\n\t\t\t// eslint-disable-next-line radix\r\n\t\t\twidth: width,\r\n\t\t\tcolor: color,\r\n\t\t\tid: parseInt(Math.random() * 100000000),\r\n\t\t  },\r\n\t\t};\r\n\t  };\r\n\t\r\n\t  getPathDataArray = (data, width, color) => {\r\n\t\tparsedArr = [];\r\n\t\tfor (var i = 0; i < data.length; i++) {\r\n\t\t  parsedArr.push(`${data[i].x},${data[i].y}`);\r\n\t\t}\r\n\t\treturn {\r\n\t\t  drawer: null,\r\n\t\t  size: {\r\n\t\t\twidth: this.canvas._size.width,\r\n\t\t\theight: this.canvas._size.height,\r\n\t\t  },\r\n\t\t  path: {\r\n\t\t\tdata: parsedArr,\r\n\t\t\t// eslint-disable-next-line radix\r\n\t\t\twidth: width,\r\n\t\t\tcolor: color,\r\n\t\t\tid: parseInt(Math.random() * 100000000),\r\n\t\t  },\r\n\t\t};\r\n\t  };\r\n\r\n\tgetBase64 = async () => {\r\n\t\tvar canvas = this.canvasRef.current\r\n\t\tconsole.log(\"Getting base64 is\", canvas.toDataURL());\r\n\r\n\t\t// toDataURL is a string on web, and a promise on android/ios\r\n\t\tvar ret = canvas.toDataURL() \r\n\r\n\t\t// web\r\n\t\tif (typeof(ret) == \"string\") {\r\n\t\t\treturn Promise.resolve(ret)\r\n\t\t// android/ios\r\n\t\t} else {\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t}\r\n\r\n\t// Send stroke point data\r\n\tonStrokeChangeHandler = (x, y) => {\r\n\t\tsendStroke(this.props.socket, {x: x, y: y}, this.props.color, this.props.thickness);\r\n\t};\r\n\r\n\t// Send stroke end signal\r\n\tonStrokeEndHandler = () => {\r\n\t\tsendStrokeEnd(this.props.socket, this.props.color, this.props.thickness);\r\n\t};\r\n\tonStrokeStartHandler = (x, y) => {\r\n\t\tsendStrokeStart(this.props.socket);\r\n\t};\r\n   \r\n    render() {\r\n      if (Platform.OS === \"web\") {\r\n\t\treturn (\r\n\t\t<View\r\n\t\tstyle= {styles.drawBoxInner}\r\n\t\tonStartShouldSetResponder={(event) => {return true;}}\r\n\t\tonMoveShouldSetResponder={(event) => {return true;}}\r\n\t\tonResponderStart={this.onDrawStart}\r\n\t\tonResponderMove={this.onDrawMove}\r\n\t\tonResponderRelease={this.onDrawEnd}\r\n\t\t>\r\n        <canvas style={{\"borderColor\":\"black\"}} ref={this.handleCanvas}  />\r\n\t\t</View>\r\n\t\t)\r\n\t} else {\r\n\t\treturn (\r\n\t\t\t<View\r\n\t\t\tonStartShouldSetResponder={(event) => {return true;}}\r\n\t\t\tonMoveShouldSetResponder={(event) => {return true;}}\r\n\t\t\tonResponderStart={this.onDrawStart}\r\n\t\t\tonResponderMove={this.onDrawMove}\r\n\t\t\tonResponderRelease={this.onDrawEnd}\r\n\t\t\tstyle= {styles.drawBox}\r\n\t\t\t>\r\n\t\t\t<Canvas width={styles.drawBox.width}\r\n\t\t\t\t\theight={styles.drawBox.height} \r\n\t\t\t\t\tref={this.handleCanvas} \r\n\t\t\t/>\r\n\t\t\t</View>\r\n\t\t)\r\n\t}\r\n    }\r\n  }\r\n\r\n"]},"metadata":{},"sourceType":"module"}